(()=>{"use strict";const e=[{id:1,code:"A1",name:"Water Bottle",price:5,icon:"https://placehold.co/100x100.png"},{id:2,code:"A2",name:"Cola",price:8,icon:"https://placehold.co/100x100.png"},{id:3,code:"A3",name:"Sprite",price:8,icon:"https://placehold.co/100x100.png"},{id:4,code:"A4",name:"Energy",price:12,icon:"https://placehold.co/100x100.png"},{id:5,code:"B1",name:"Chips",price:6,icon:"https://placehold.co/100x100.png"},{id:6,code:"B2",name:"Doritos",price:7,icon:"https://placehold.co/100x100.png"},{id:7,code:"B3",name:"Pretzels",price:6,icon:"https://placehold.co/100x100.png"}];let t=null,n={},i=e,c=!1;function initializeUI(e){i=e;const t=document.getElementById("shelves");t.innerHTML="",e.forEach(e=>{const n=document.createElement("div");n.className="shelf-item",n.dataset.itemId=e.id,n.innerHTML=`\n            <div class="item-slot"><img src="${e.icon}" width="100" height="100"alt="${e.name}"></div>\n            <div class="item-label">${e.name.substring(0,14)}</div>\n            <div class="item-controls">\n                <button class="btn-minus" onclick="event.stopPropagation(); decrementItem(${e.id})">âˆ’</button>\n                <div class="item-cost">$${e.price}</div>\n                <button class="btn-plus" onclick="event.stopPropagation(); incrementItem(${e.id})">+</button>\n            </div>\n        `,n.onclick=()=>selectItem(e,n),t.appendChild(n)}),document.getElementById("dispenseBtn").onclick=dispense,updateCartDisplay(),showDefaultSelectedPrompt()}function init(){initializeUI(e)}function updateCartDisplay(){const e=document.getElementById("cartItems"),t=document.getElementById("totalPrice"),i=Object.values(n);if(0===i.length)return e.innerHTML='<div class="empty-cart">No items selected</div>',void(t.textContent="$0");let c=0;e.innerHTML="",i.forEach(t=>{const{item:n,quantity:i}=t,d=n.price*i;c+=d;const s=document.createElement("div");s.className="cart-item",s.innerHTML=`\n            <div class="cart-item-info">\n                <span class="cart-item-name">${n.name.substring(0,14)}</span>\n                <span class="cart-item-qty">x${i}</span>\n                <span class="cart-item-price">$${d}</span>\n            </div>\n        `,e.appendChild(s)}),t.textContent="$"+c}function showDefaultSelectedPrompt(){document.getElementById("selectedDisplay").innerHTML='<div style="color: #00ff00; font-size: 14px;">â—„ CLICK ITEM TO SELECT â–º</div>'}function showFallbackSelectedFromCart(){const e=Object.values(n);if(0===e.length)return void showDefaultSelectedPrompt();const{item:t}=e[e.length-1];highlightShelfItem(t.id),updateSelectedDisplayFromCart(t.id)}function syncSelectedDisplay(e){if(e&&n[e])return highlightShelfItem(e),void updateSelectedDisplayFromCart(e);if(e){const n=i.find(t=>t.id===e);if(n){highlightShelfItem(e);const i=document.getElementById("selectedDisplay");return t=n,void(i.innerHTML=`\n            <img src="${n.icon}" width="80" height="80" alt="${n.name}">\n            <div class="selected-details">\n                <div class="selected-name">${n.name}</div>\n                <div class="selected-price">$${n.price}</div>\n            </div> `)}}showFallbackSelectedFromCart()}function updateSelectedDisplayFromCart(e){const n=i.find(t=>t.id===e);if(!n)return void showDefaultSelectedPrompt();const c=document.getElementById("selectedDisplay");t=n,c.innerHTML=`\n            <img src="${n.icon}" width="80" height="80" alt="${n.name}">\n            <div class="selected-details">\n                <div class="selected-name">${n.name}</div>\n                <div class="selected-price">$${n.price}</div>\n            </div> `}function selectItem(e,n){document.querySelectorAll(".shelf-item").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),t=e,updateSelectedDisplayFromCart(e.id)}function dispense(){const e=document.getElementById("dispenseBtn");0===Object.keys(n).length||e.disabled||(e.disabled=!0,e.textContent="Dispensing...",function(){const e=Object.values(n).map(e=>({item:e.item.code,name:e.item.name,price:e.item.price,quantity:e.quantity,total:e.item.price*e.quantity}));fetch(`https://${GetParentResourceName()}/buyItems`,{method:"POST",body:JSON.stringify({items:e})}),closeUI()}(),setTimeout(()=>{resetAfterDispatch(),e.textContent="Dispense Items"},800))}function resetAfterDispatch(){n={},document.querySelectorAll(".shelf-item").forEach(e=>e.classList.remove("selected")),t=null,showDefaultSelectedPrompt(),updateCartDisplay(),document.getElementById("dispenseBtn").disabled=!0}function addToCart(e){n[e.id]?n[e.id].quantity+=1:n[e.id]={item:e,quantity:1},updateCartDisplay(),syncSelectedDisplay(e.id),document.getElementById("dispenseBtn").disabled=!1}function highlightShelfItem(e){document.querySelectorAll(".shelf-item").forEach(e=>e.classList.remove("selected"));const t=document.querySelector(`.shelf-item[data-item-id="${e}"]`);t&&t.classList.add("selected")}function closeUI(){fetch(`https://${GetParentResourceName()}/close`,{method:"POST"})}document.addEventListener("keydown",e=>{"Escape"===e.key&&closeUI()}),window.addEventListener("message",e=>{const t=e.data;"open"===t.action?(c=!0,document.body.style.display="flex",t.items&&t.items.length>0&&initializeUI(t.items.map((e,t)=>({id:t+1,code:e.item,name:e.label,price:e.price,icon:e.icon||"ðŸ“¦"})))):"close"===t.action&&(document.body.style.display="none",n={})}),setTimeout(()=>{c||init()},100),"undefined"!=typeof window&&(window.initializeUI=initializeUI,window.init=init,window.updateCartDisplay=updateCartDisplay,window.selectItem=selectItem,window.dispense=dispense,window.resetAfterDispatch=resetAfterDispatch,window.addToCart=addToCart,window.incrementItem=function(e){const t=i.find(t=>t.id===e);t&&addToCart(t)},window.decrementItem=function(e){i.find(t=>t.id===e)&&highlightShelfItem(e),n[e]&&(n[e].quantity-=1,n[e].quantity<=0&&delete n[e],updateCartDisplay(),0===Object.keys(n).length)&&(document.getElementById("dispenseBtn").disabled=!0),syncSelectedDisplay(e)},window.highlightShelfItem=highlightShelfItem,window.resetSelection=function(){document.querySelectorAll(".shelf-item").forEach(e=>e.classList.remove("selected")),t=null,showDefaultSelectedPrompt(),document.getElementById("dispenseBtn").disabled=!0},window.closeUI=closeUI,window.syncSelectedDisplay=syncSelectedDisplay,window.updateSelectedDisplayFromCart=updateSelectedDisplayFromCart,window.showDefaultSelectedPrompt=showDefaultSelectedPrompt,window.showFallbackSelectedFromCart=showFallbackSelectedFromCart),window.VendingApp={}.default})();